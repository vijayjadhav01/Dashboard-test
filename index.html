<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>New Design Dashboard</title>
  <link rel="stylesheet" href="./style.css">

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>New Design Dashboard</title>
  <link rel="stylesheet" href="./style.css">

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Commodity Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <!-- Header - Keep exactly as is -->
    <header class="header">
        <div class="header-left">
            <img src="https://raw.githubusercontent.com/vijayjadhav01/commodity-dashboard/main/Logo.png" alt="IndiaSpend Logo" class="logo">
        </div>
        <div class="header-center">
            <h1 class="dashboard-title">Food Commodity Dashboard</h1>
        </div>
        <div class="header-right">
            <div class="current-date" id="currentDate">Friday, July 18, 2025</div>
        </div>
    </header>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="state-map">
                    <span class="menu-icon">üó∫Ô∏è</span>
                    <span class="menu-text">Regional Analysis</span>
                </div>
                <div class="menu-item" data-section="trends">
                    <span class="menu-icon">üìà</span>
                    <span class="menu-text">Trends</span>
                </div>
                <div class="menu-item" data-section="diet-calculator">
                    <span class="menu-icon">üçΩÔ∏è</span>
                    <span class="menu-text">Diet Calculator</span>
                </div>
                <div class="menu-item" data-section="recent-stories">
                    <span class="menu-icon">üì∞</span>
                    <span class="menu-text">Recent Stories</span>
                </div>
                <div class="menu-item" data-section="about">
                    <span class="menu-icon">‚ÑπÔ∏è</span>
                    <span class="menu-text">About</span>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- STATE-WISE MAP SECTION -->
            <section id="state-map-section" class="content-section active">
              
              <!-- NEW: Monthly Average Map Container - ADD THIS ONLY -->
<h1 class="map-section-header">Monthly Average Prices</h1>
<div class="card">
    <div class="map-section">
        <div class="map-sidebar">
            <div class="map-controls">
                <div class="control-group">
                    <label for="monthlyMapMonth">Month</label>
                    <select id="monthlyMapMonth" class="select-input">
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="monthlyMapYear">Year</label>
                    <select id="monthlyMapYear" class="select-input">
                        <!-- Will be populated dynamically from 2014 to current year -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="monthlyMapGroup">Commodity Group</label>
                    <select id="monthlyMapGroup" class="select-input">
                        <option value="">Select Group</option>
                        <option value="Food Grains">Food Grains</option>
                        <option value="Edible Oils">Edible Oils</option>
                        <option value="Pulses">Pulses</option>
                        <option value="Vegetables">Vegetables</option>
                        <option value="Other Items">Other Items</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="monthlyMapCommodity">Commodity</label>
                    <select id="monthlyMapCommodity" class="select-input" disabled>
                        <option value="">Select Commodity</option>
                    </select>
                </div>
                
                <button id="monthlyMapSearch" class="search-btn" disabled>Search</button>
            </div>

            <div class="map-legend" id="monthlyMapLegend"></div>
        </div>
        
        <div class="map-container">
            <div class="india-map" id="monthlyIndiaMap">
                <div class="map-placeholder">Loading monthly average map...</div>
            </div>
        </div>
    </div>
</div>

<!-- Monthly Average Prices Map card -->

<div class="card">
    <h3 class="section-title">Historical Price Trends</h3>
    
    <!-- Chart Filters -->
    <div class="regional-chart-filters">
        
        <!-- First Row: Commodity Group and Commodity -->
        <div class="filter-row-one">
            
            <!-- Commodity Group Selection -->
            <div class="control-group">
                <label for="regionalChartGroup">Select Group</label>
                <select id="regionalChartGroup" class="select-input">
                    <option value="">Choose Group</option>
                    <option value="Food Grains">Food Grains</option>
                    <option value="Edible Oils">Edible Oils</option>
                    <option value="Pulses">Pulses</option>
                    <option value="Vegetables">Vegetables</option>
                    <option value="Other Items">Other Items</option>
                </select>
            </div>
            
            <!-- Commodity Selection -->
            <div class="control-group">
                <label for="regionalChartCommodity">Select Commodity</label>
                <select id="regionalChartCommodity" class="select-input" disabled>
                    <option value="">Choose Commodity</option>
                </select>
            </div>
            
        </div>
        
        <!-- Second Row: State Selection -->
        <div class="filter-row-two">
            <label>Select States (Multiple)</label>
            
            <div class="state-selection-container">
                <button id="stateSelectionToggle" class="state-toggle-btn">
                    <span id="stateSelectionText">Choose States...</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                
                <div id="stateSelectionDropdown" class="state-dropdown">
                    <div class="state-search-container">
                        <input type="text" id="stateSearchInput" placeholder="Search states..." class="state-search-input">
                    </div>
                    <div id="stateCheckboxContainer">
                        <!-- State checkboxes will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Third Row: Date Range Filter -->
        <div class="filter-row-three">
            <label>Time Range</label>
            <div class="time-range-buttons">
                <button class="time-range-btn" data-range="6months">6 Months</button>
                <button class="time-range-btn" data-range="1year">1 Year</button>
                <button class="time-range-btn" data-range="2years">2 Years</button>
                <button class="time-range-btn" data-range="5years">5 Years</button>
                <button class="time-range-btn active" data-range="all">All Data</button>
            </div>
        </div>
        
    </div>
    
    <!-- Chart Section -->
    <div class="regional-chart-section" id="regionalChartSection" style="display: none;">
        <div class="regional-chart-container">
            <canvas id="regionalHistoricalChart"></canvas>
        </div>
        
        <!-- Chart Controls -->
        <div class="regional-chart-controls" style="text-align: center; margin-top: 1rem;">
    <button id="downloadRegionalChart" class="download-btn" style="display: none;">
        Download Chart Image
    </button>
    <button id="downloadRegionalData" class="download-btn" style="display: none; margin-left: 1rem;">
        Download Data (CSV)
    </button>
    <button id="clearRegionalChart" class="download-btn" style="background: #dc3545; margin-left: 1rem;">
        Clear All
    </button>
</div>
              
                <!-- Original Map Container Datewise -->
                <div class="card">
                    <div class="map-section">
                        <div class="map-sidebar">
                            <div class="map-controls">
                                <div class="control-group">
                                    <label for="mapDate">Date</label>
                                    <input type="date" id="mapDate" class="date-input">
                                </div>
                                
                                <div class="control-group">
                                    <label for="mapGroup">Commodity Group</label>
                                    <select id="mapGroup" class="select-input">
                                        <option value="">Select Group</option>
                                        <option value="Food Grains">Food Grains</option>
                                        <option value="Edible Oils">Edible Oils</option>
                                        <option value="Pulses">Pulses</option>
                                        <option value="Vegetables">Vegetables</option>
                                        <option value="Other Items">Other Items</option>
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label for="mapCommodity">Commodity</label>
                                    <select id="mapCommodity" class="select-input" disabled>
                                        <option value="">Select Commodity</option>
                                    </select>
                                </div>
                                
                                <button id="mapSearch" class="search-btn" disabled>Search</button>
                            </div>

                            <div class="kpi-section">
                                <div class="kpi-current" id="kpiCurrent">
                                    <h4>Current Day Summary</h4>
                                    <div class="kpi-grid">
                                        <div class="kpi-item">
                                            <span class="kpi-label">Average</span>
                                            <span class="kpi-value" id="avgPrice">--</span>
                                        </div>
                                        <div class="kpi-item">
                                            <span class="kpi-label">Maximum</span>
                                            <span class="kpi-value" id="maxPrice">--</span>
                                        </div>
                                        <div class="kpi-item">
                                            <span class="kpi-label">Minimum</span>
                                            <span class="kpi-value" id="minPrice">--</span>
                                        </div>
                                        <div class="kpi-item">
                                            <span class="kpi-label">Modal</span>
                                            <span class="kpi-value" id="modalPrice">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="map-legend" id="mapLegend"></div>
                        </div>
                        
                        <div class="map-container">
                            <div class="india-map" id="indiaMap">
                                <div class="map-placeholder">Loading map...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: Top 5 High/Low States -->
                <div class="top-states-container">
                    <div class="card">
                        <div class="states-card-header">
                            <h3 class="states-title">Top 5 High Prices</h3>
                        </div>
                        <div class="states-list" id="highPricesList">
                            <div class="states-loading">Select commodity to view data</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="states-card-header">
                            <h3 class="states-title">Top 5 Low Prices</h3>
                        </div>
                        <div class="states-list" id="lowPricesList">
                            <div class="states-loading">Select commodity to view data</div>
                        </div>
                    </div>
                </div>

                <!-- Latest Prices Section -->
                <div class="card">
                    <h3 class="summary-title" id="summaryTitle">Latest Prices</h3>
                    <div class="summary-grid" id="summaryGrid">
                        <div class="loading-message">Loading market data...</div>
                    </div>
                </div>
            </section>

            <!-- TRENDS SECTION -->
            <section id="trends-section" class="content-section">
                <div class="card">
                    <!-- Group Navigation -->
                    <div class="group-navigation">
                        <h3 class="section-title">Choose Group</h3>
                        <div class="group-tabs">
                            <button class="group-tab" data-group="Food Grains">Food Grains</button>
                            <button class="group-tab" data-group="Edible Oils">Edible Oils</button>
                            <button class="group-tab" data-group="Pulses">Pulses</button>
                            <button class="group-tab" data-group="Vegetables">Vegetables</button>
                            <button class="group-tab" data-group="Other Items">Other Items</button>
                        </div>
                    </div>
                    
                    <!-- Commodity Selection -->
                    <div class="commodity-selection" id="commoditySelection" style="display: none;">
                        <h3 class="section-title">Select Commodities</h3>
                        <div class="commodity-checkboxes" id="commodityCheckboxes">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Date Range Filter -->
                    <div class="date-filter-section" id="dateFilterSection" style="display: none;">
                        <h3 class="section-title">Date Range Filter (Optional)</h3>
                        <div class="date-filter-buttons">
                            <button class="date-filter-btn" data-range="30">Last Month</button>
                            <button class="date-filter-btn" data-range="90">Last 3 Months</button>
                            <button class="date-filter-btn" data-range="180">Last 6 Months</button>
                            <button class="date-filter-btn" data-range="365">Last Year</button>
                            <button class="date-filter-btn active" data-range="all">Show All Data</button>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="chart-section" id="chartSection" style="display: none;">
                        <div class="chart-container">
                            <canvas id="commodityChart"></canvas>
                        </div>
                        <div class="chart-controls" style="text-align: center; margin-top: 1rem;">
                            <button id="downloadChart" class="download-btn" style="display: none;">
                                Download Chart Image
                            </button>
                            <button id="downloadData" class="download-btn" style="display: none; margin-left: 1rem;">
                                Download Data
                            </button>
                        </div>
                    </div>

                    <!-- Combined Averages Section -->
                    <div class="combined-averages-section" id="combinedAveragesSection" style="display: none;">
                        <h3 class="section-title">Price Averages</h3>
                        <div class="averages-horizontal-container">
                            <!-- Monthly Averages Chart -->
                            <div class="averages-column">
                                <h4 class="averages-subtitle">Monthly Avg</h4>
                                <div class="averages-chart" id="monthlyAveragesChart">
                                    <canvas id="monthlyChart" style="width: 100%; height: 400px;"></canvas>
                                </div>
                            </div>
                            
                            <!-- Weekly Averages Chart -->
                            <div class="averages-column">
                                <h4 class="averages-subtitle">Weekly Avg (7 Day Rolling Average)</h4>
                                <div class="averages-chart" id="weeklyAveragesChart">
                                    <canvas id="weeklyChart" style="width: 100%; height: 400px;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- DIET CALCULATOR SECTION - SINGLE CONTAINER REDESIGN -->
            <section id="diet-calculator-section" class="content-section">
                <div class="card">
                    <h3 class="section-title">Daily Diet Cost Calculator</h3>
                    
                    <!-- SINGLE COMBINED CONTAINER -->
                    <div class="diet-breakdown-section">
                        <!-- Latest Data -->
                        <div class="data-date-info">
                            <span class="data-date-label">Latest Data: <span id="dietDataDate">July 18, 2025</span></span>
                        </div>
                        
                        <!-- Cost Summary Table -->
                        <div class="cost-summary-table">
                            <div class="cost-summary-header">
                                <span class="cost-type-header"></span>
                                <span class="person-header">1 Person</span>
                                <span class="family-header">Family (4 Persons)</span>
                            </div>
                            
                            <div class="cost-summary-row">
                                <span class="cost-type-label">Daily Cost:</span>
                                <span class="person-cost-value" id="dailyCost1">Rs 54.38</span>
                                <span class="family-cost-value" id="dailyCost4">Rs 217.52</span>
                            </div>
                            
                            <div class="cost-summary-row">
                                <span class="cost-type-label">Monthly Total:</span>
                                <span class="person-cost-value" id="monthlyTotal1">Rs 1631.44</span>
                                <span class="family-cost-value" id="monthlyTotal4">Rs 6525.74</span>
                            </div>
                        </div>

                        <!-- Breakdown Title -->
                        <h4 class="breakdown-section-title">ü•ó Breakdown (Daily)</h4>
                        
                        <!-- Horizontal Breakdown Items -->
                        <div class="breakdown-items-horizontal">
                            <div class="breakdown-item-card">
                                <span class="item-category">Cereals</span>
                                <span class="item-amount">(250g)</span>
                                <span class="item-cost" id="cerealsCost">Rs 9.22</span>
                            </div>
                            
                            <div class="breakdown-item-card">
                                <span class="item-category">Pulses</span>
                                <span class="item-amount">(85g)</span>
                                <span class="item-cost" id="pulsesCost">Rs 8.86</span>
                            </div>
                            
                            <div class="breakdown-item-card">
                                <span class="item-category">Vegetables</span>
                                <span class="item-amount">(400g)</span>
                                <span class="item-cost" id="vegetablesCost">Rs 12.73</span>
                            </div>
                            
                            <div class="breakdown-item-card">
                                <span class="item-category">Oils</span>
                                <span class="item-amount">(27g)</span>
                                <span class="item-cost" id="oilsCost">Rs 4.55</span>
                            </div>
                            
                            <div class="breakdown-item-card">
                                <span class="item-category">Milk</span>
                                <span class="item-amount">(300ml)</span>
                                <span class="item-cost" id="milkCost">Rs 17.77</span>
                            </div>
                            
                            <div class="breakdown-item-card">
                                <span class="item-category">Salt</span>
                                <span class="item-amount">(5g)</span>
                                <span class="item-cost" id="saltCost">Rs 0.11</span>
                            </div>
                            
                            <div class="breakdown-item-card">
                                <span class="item-category">Sugar</span>
                                <span class="item-amount">(25g)</span>
                                <span class="item-cost" id="sugarCost">Rs 1.15</span>
                            </div>
                        </div>
                        
                        <!-- Total Section -->
                        <div class="breakdown-total-section">
                            <div class="total-separator"></div>
                            <div class="breakdown-total">
                                <span class="total-label">Daily Total:</span>
                                <span class="total-value" id="totalCost">Rs 54.38</span>
                            </div>
                        </div>

                        <!-- How We Calculate Section -->
                        <div class="calculation-methodology">
                            <h4 class="methodology-title">How We Calculate:</h4>
                            <div class="methodology-content">
                                <p><strong>Daily Nutritional Requirements:</strong></p>
                                <p class="requirements-text">
                                    <strong>Cereals: 250g</strong> | <strong>Pulses: 85g</strong> | <strong>Vegetables: 400g</strong> | <strong>Oils: 27g</strong> | <strong>Milk: 300ml</strong> | <strong>Salt: 5g</strong> | <strong>Sugar: 25g</strong>
                                </p>
                                <p class="methodology-note">
                                    <em>* Based on <a href="https://www.nin.res.in/dietaryguidelines/pdfjs/locale/DGI07052024P.pdf" target="_blank" rel="noopener noreferrer">Dietary Guidelines for Indians</a> - ICMR-National Institute of Nutrition. 
                                    Costs calculated using average market prices of available commodities.</em>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diet Cost Trends Analysis -->
                <div class="card">
                    <h3 class="section-title">Diet Cost Trends Analysis</h3>
                    
                    <!-- Trend Controls -->
                    <div class="diet-trends-controls">
                        <div class="family-size-filter">
                            <label class="filter-label">Family Size:</label>
                            <div class="family-size-buttons">
                                <button class="family-size-btn" data-size="1">1 Person</button>
                                <button class="family-size-btn active" data-size="4">Family (4 Persons)</button>
                            </div>
                        </div>
                        
                        <div class="date-range-filter">
                            <label class="filter-label">Date Range:</label>
                            <div class="date-range-buttons">
                                <button class="date-range-btn" data-range="6months">Last 6 Months</button>
                                <button class="date-range-btn" data-range="1year">Last Year</button>
                                <button class="date-range-btn active" data-range="3years">Last 3 Years</button>
                                <button class="date-range-btn" data-range="6years">Last 6 Years</button>
                                <button class="date-range-btn" data-range="all">All Time</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- National Trends Chart -->
                    <div class="diet-trends-chart-section">
                        <h4 class="trends-chart-title" id="dietTrendsChartTitle">National Average - Diet Cost Trends (All Time)</h4>
                        <div class="trends-chart-container">
                            <canvas id="nationalDietChart"></canvas>
                        </div>
                        <div class="chart-controls" style="text-align: center; margin-top: 1rem;">
                            <button id="downloadDietChart" class="download-btn">
                                üì• Download Chart Image
                            </button>
                        </div>
                    </div>
                    
                    <!-- State-wise Heatmap -->
                    <div class="diet-heatmap-section">
                        <h4 class="trends-chart-title">State-wise Comparison - Last 10 Days</h4>
                        <div class="trends-heatmap-container" id="stateHeatmapContainer">
                            <div class="trends-heatmap-placeholder">
                                üó∫Ô∏è Interactive Heatmap: States √ó Last 10 Days
                                <br>Showing most recent state-wise diet cost data
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RECENT STORIES SECTION -->
            <section id="recent-stories-section" class="content-section">
                <div class="card">
                    <h3 class="section-title">Recent Stories</h3>
                    <div class="stories-container">
                        <div class="stories-embed">
                            <iframe 
                                src="https://www.indiaspend.com/tags/inflation" 
                                frameborder="0" 
                                style="width: 100%; height: 600px; border-radius: 8px;"
                                title="IndiaSpend Inflation Stories">
                            </iframe>
                        </div>
                        <div class="stories-note">
                            <p><em>Latest inflation and food commodity stories from IndiaSpend</em></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ABOUT SECTION -->
            <section id="about-section" class="content-section">
    <div class="card">
        <h3 class="section-title">About</h3>
        <div class="about-content">
            <div class="about-text">
                <p>This Food Commodity Price Dashboard is a project by <a href="https://www.indiaspend.com/" target="_blank" rel="noopener noreferrer">IndiaSpend.com</a>, designed to track daily retail prices of <a href="https://fcainfoweb.nic.in/Essential_comm.aspx" target="_blank" rel="noopener noreferrer">22 essential food commodities</a> across India. The dashboard sources its data from the <a href="https://fcainfoweb.nic.in/reports/Report_Menu_Web.aspx" target="_blank" rel="noopener noreferrer">Price Monitoring Cell </a> under the Department of Consumer Affairs, which collects prices from market centres in every Indian state and Union Territory.</p>
                
                <p>IndiaSpend automatically fetches and processes the latest available data each evening, allowing users to visualize and analyze food price trends by commodity and by state. The dashboard makes it easy for journalists, researchers, policymakers, and the public to monitor changes in food prices and understand trends at both state and national levels.</p>
                
                <p class="note"><strong>Note:</strong> The latest day's data is published on the dashboard after 6 PM IST each day.</p>
            </div>
        </div>
    </div>
</section>



            <!-- Source Information -->
            <section class="source-section">
                <div class="card">
                    <p class="source-text">
                        <strong>Source:</strong> Department of Consumer Affairs, Ministry of Consumer Affairs, Food and Public Distribution, Government of India.
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Loading data...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script>
        // Check if D3 loaded properly and add fallback
        if (typeof d3 === 'undefined') {
            console.error('D3.js failed to load from CDN');
            window.d3Loaded = false;
        } else {
            console.log('D3.js loaded successfully');
            window.d3Loaded = true;
        }
    </script>
    <script src="./script.js"></script>
</body>
</html>
<!-- partial -->
  <script src='https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600;700&amp;display=swap'></script>
<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<script src='https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns'></script>
<script src='https://d3js.org/d3.v7.min.js'></script>
<script src='https://d3js.org/topojson.v3.min.js'></script><script  src="./script.js"></script>

</body>
</html>
<!-- partial -->
  <script src='https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600;700&amp;display=swap'></script>
<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<script src='https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns'></script>
<script src='https://d3js.org/d3.v7.min.js'></script>
<script src='https://d3js.org/topojson.v3.min.js'></script><script  src="./script.js"></script>

</body>
</html>
