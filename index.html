<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Commodity Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="https://raw.githubusercontent.com/vijayjadhav01/commodity-dashboard/main/Logo.png" alt="IndiaSpend Logo" class="logo">
        </div>
        <div class="header-center">
            <h1 class="dashboard-title">Food Commodity Dashboard</h1>
        </div>
        <div class="header-right">
            <div class="current-date" id="currentDate">Friday, July 18, 2025</div>
        </div>
    </header>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation - REORDERED -->
        <nav class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="diet-calculator">
                    <span class="menu-icon">üçΩÔ∏è</span>
                    <span class="menu-text">Cost of a Healthy Diet</span>
                </div>
                <div class="menu-item" data-section="state-map">
                    <span class="menu-icon">üó∫Ô∏è</span>
                    <span class="menu-text">Food prices, by State</span>
                </div>
                <div class="menu-item" data-section="trends">
                    <span class="menu-icon">üìà</span>
                    <span class="menu-text">Compare earlier prices</span>
                </div>
                <div class="menu-item" data-section="recent-stories">
                    <span class="menu-icon">üì∞</span>
                    <span class="menu-text">Recent Stories</span>
                </div>
                <div class="menu-item" data-section="about">
                    <span class="menu-icon">‚ÑπÔ∏è</span>
                    <span class="menu-text">About</span>
                </div>
            </div>
        </nav>

<!-- Main Content Area -->
        <main class="main-content">
            
            <!-- DIET CALCULATOR SECTION - NOW FIRST -->
            <section id="diet-calculator-section" class="content-section active">
                <div class="card">
                    <h3 class="section-title">Cost of a Healthy Diet</h3>
<div class="data-date-info" id="dietDataDateInfo" align="center">
    Date: <span id="dietDataDate">Loading...</span>
</div>
                    
                    <!-- Diet Cost Map Container -->
                    <div class="diet-cost-map-section">
                        <!-- Toggle Controls -->
                        <div class="diet-cost-controls" style="text-align: center; margin-bottom: 2rem;">
                            <div class="diet-cost-toggle">
                                <button class="diet-cost-btn active" data-period="daily">Daily Cost</button>
                                <button class="diet-cost-btn" data-period="monthly">Monthly Cost</button>
                            </div>
                        </div>
                        
                        <!-- Map and Statistics Layout -->
                        <div class="diet-cost-layout" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <!-- Diet Cost Map -->
                            <div class="map-container">
    <div class="india-map" id="dietCostMap">
        <div class="map-placeholder">Loading diet cost map...</div>
    </div>
</div>
                            
                            <!-- National Statistics Panel -->
                            <div class="national-stats-panel">
                                <h4 class="stats-title">National Statistics</h4>
                                <div class="stats-content">
                                    <div class="stat-item">
                                        <span class="stat-label">1 Person:</span>
                                        <span class="stat-value" id="nationalAvgCost">Rs 54.38/day</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Family (4 persons):</span>
                                        <span class="stat-value" id="familyAvgCost">Rs 217.52/day</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Highest State:</span>
                                        <span class="stat-value" id="highestStateCost">Loading...</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Lowest State:</span>
                                        <span class="stat-value" id="lowestStateCost">Loading...</span>
                                    </div>                                   
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Diet Cost Trends Analysis - SIMPLIFIED -->
                    <div class="diet-trends-analysis">
                        <h3 class="section-title">Diet Cost Trends - Last 3 Years</h3>
                        
                        <!-- Family Size Filter Only -->
                        <div class="diet-trends-controls" style="text-align: center; margin-bottom: 2rem;">
                            <div class="family-size-filter">
                                <label class="filter-label">Family Size:</label>
                                <div class="family-size-buttons">
                                    <button class="family-size-btn" data-size="1">1 Person</button>
                                    <button class="family-size-btn active" data-size="4">Family (4 Persons)</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- National Trends Chart -->
                        <div class="diet-trends-chart-section">
                            <div class="trends-chart-container">
                                <canvas id="nationalDietChart"></canvas>
                            </div>
                            <div class="chart-controls" style="text-align: center; margin-top: 1rem;">
                                <button id="downloadDietChart" class="download-btn">
                                    Download Chart Image
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

<!-- How We Calculate Section -->
<div class="calculation-methodology" align="center">
    <h4 class="methodology-title">How We Calculate:</h4>
    <div class="methodology-content">
        <p align="center"><strong>Daily Nutritional Requirements:</strong></p>
        <p class="requirements-text" align="center" style="text-align: center;">
            <strong>Cereals: 250g</strong> | <strong>Pulses: 85g</strong> | <strong>Vegetables: 400g</strong> | <strong>Oils: 27g</strong> | <strong>Milk: 300ml</strong> | <strong>Salt: 5g</strong> | <strong>Sugar: 25g</strong>
        </p>
        <p class="methodology-note" align="center" style="text-align: center;">
            <em>* Based on <a href="https://www.nin.res.in/dietaryguidelines/pdfjs/locale/DGI07052024P.pdf" target="_blank" rel="noopener noreferrer">Dietary Guidelines for Indians</a> - ICMR-National Institute of Nutrition. 
            Costs calculated using average market prices of available commodities.</em>
        </p>
    </div>
</div>

            </section>

            <!-- STATE MAP SECTION - NOW SECOND, SIMPLIFIED -->
            <section id="state-map-section" class="content-section">
                
                <!-- Monthly Average Map Container - KEEP AS IS -->
                <h1 class="map-section-header">Monthly Average Prices</h1>
                <div class="card">
                    <div class="map-section">
                        <div class="map-sidebar">
                            <div class="map-controls">
                                <div class="control-group">
                                    <label for="monthlyMapMonth">Month</label>
                                    <select id="monthlyMapMonth" class="select-input">
                                        <option value="January">January</option>
                                        <option value="February">February</option>
                                        <option value="March">March</option>
                                        <option value="April">April</option>
                                        <option value="May">May</option>
                                        <option value="June">June</option>
                                        <option value="July">July</option>
                                        <option value="August">August</option>
                                        <option value="September">September</option>
                                        <option value="October">October</option>
                                        <option value="November">November</option>
                                        <option value="December">December</option>
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label for="monthlyMapYear">Year</label>
                                    <select id="monthlyMapYear" class="select-input">
                                        <!-- Will be populated dynamically from 2014 to current year -->
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label for="monthlyMapGroup">Commodity Group</label>
                                    <select id="monthlyMapGroup" class="select-input">
                                        <option value="">Select Group</option>
                                        <option value="Food Grains">Food Grains</option>
                                        <option value="Edible Oils">Edible Oils</option>
                                        <option value="Pulses">Pulses</option>
                                        <option value="Vegetables">Vegetables</option>
                                        <option value="Other Items">Other Items</option>
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label for="monthlyMapCommodity">Commodity</label>
                                    <select id="monthlyMapCommodity" class="select-input" disabled>
                                        <option value="">Select Commodity</option>
                                    </select>
                                </div>
                                
                                <button id="monthlyMapSearch" class="search-btn" disabled>Search</button>
                            </div>

                            <div class="map-legend" id="monthlyMapLegend"></div>
                        </div>
                        
                        <div class="map-container">
                            <div class="india-map" id="monthlyIndiaMap">
                                <div class="map-placeholder">Loading monthly average map...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top 5 High/Low States - MODIFIED TO CONNECT TO MONTHLY DATA -->
                <div class="top-states-container">
                    <div class="card">
                        <div class="states-card-header">
                            <h3 class="states-title" id="highPricesTitle">Top 5 High Prices</h3>
                            <p class="states-subtitle" id="highPricesSubtitle">Select commodity to view data</p>
                        </div>
                        <div class="states-list" id="highPricesList">
                            <div class="states-loading">Select commodity to view data</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="states-card-header">
                            <h3 class="states-title" id="lowPricesTitle">Top 5 Low Prices</h3>
                            <p class="states-subtitle" id="lowPricesSubtitle">Select commodity to view data</p>
                        </div>
                        <div class="states-list" id="lowPricesList">
                            <div class="states-loading">Select commodity to view data</div>
                        </div>
                    </div>
                </div>
            </section>

<!-- TRENDS SECTION - NOW THIRD, COMPLETELY RESTRUCTURED -->
            <section id="trends-section" class="content-section">
                
                <!-- Latest Prices Section - MOVED FROM REGIONAL ANALYSIS -->
                <div class="card">
                    <h3 class="summary-title" id="summaryTitle">Latest Prices</h3>
                    <div class="summary-grid" id="summaryGrid">
                        <div class="loading-message">Loading market data...</div>
                    </div>
                </div>
                
                <!-- Price Averages with Filters - COMPLETELY NEW STRUCTURE -->
                <div class="card">
                    <h3 class="section-title">Price Averages</h3>
                    
                    <!-- Three Sequential Filters -->
                    <div class="trends-filters">
                        <div class="filter-row">
                            <div class="control-group">
                                <label for="trendsGroup">Choose Group</label>
                                <select id="trendsGroup" class="select-input">
                                    <option value="">Select Group</option>
                                    <option value="Food Grains">Food Grains</option>
                                    <option value="Edible Oils">Edible Oils</option>
                                    <option value="Pulses">Pulses</option>
                                    <option value="Vegetables">Vegetables</option>
                                    <option value="Other Items">Other Items</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label for="trendsCommodity">Choose Commodity</label>
                                <select id="trendsCommodity" class="select-input" disabled>
                                    <option value="">Select Commodity</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label for="trendsAverageRange">Choose Average Range</label>
                                <select id="trendsAverageRange" class="select-input" disabled>
                                    <option value="monthly">Monthly Avg</option>
                                    <option value="weekly">Weekly Avg (7-Day Rolling)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Single Chart Display -->
                    <div class="trends-chart-section" id="trendsChartSection" style="display: none;">
                        <h4 class="trends-chart-title" id="trendsChartTitle">Price Averages</h4>
                        <div class="trends-chart-container">
                            <canvas id="trendsChart"></canvas>
                        </div>
                        <div class="chart-controls" style="text-align: center; margin-top: 1rem;">
                            <button id="downloadTrendsChart" class="download-btn" style="display: none;">
                                Download Chart Image
                            </button>
                            <button id="downloadTrendsData" class="download-btn" style="display: none; margin-left: 1rem;">
                                Download Data
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RECENT STORIES SECTION - UNCHANGED -->
            <section id="recent-stories-section" class="content-section">
                <div class="card">
                    <h3 class="section-title">Recent Stories</h3>
                    <div class="stories-container">
                        <div class="stories-embed">
                           <!-- tag link goes here in iframe --> 
                        </div>
                        <div class="stories-note">
                            <p><em>Latest inflation and food commodity stories from IndiaSpend</em></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ABOUT SECTION - UNCHANGED -->
            <section id="about-section" class="content-section">
                <div class="card">
                    <h3 class="section-title">About</h3>
                    <div class="about-content">
                        <div class="about-text">
                            <p>This Food Commodity Price Dashboard is a project by <a href="https://www.indiaspend.com/" target="_blank" rel="noopener noreferrer">IndiaSpend.com</a>, designed to track daily retail prices of <a href="https://fcainfoweb.nic.in/Essential_comm.aspx" target="_blank" rel="noopener noreferrer">22 essential food commodities</a> across India. The dashboard sources its data from the <a href="https://fcainfoweb.nic.in/reports/Report_Menu_Web.aspx" target="_blank" rel="noopener noreferrer">Price Monitoring Cell </a> under the Department of Consumer Affairs, which collects prices from market centres in every Indian state and Union Territory.</p>
                            
                            <p>IndiaSpend automatically fetches and processes the latest available data each evening, allowing users to visualize and analyze food price trends by commodity and by state. The dashboard makes it easy for journalists, researchers, policymakers, and the public to monitor changes in food prices and understand trends at both state and national levels.</p>
                            
                            <p class="note"><strong>Note:</strong> The latest day's data is published on the dashboard after 6 PM IST each day.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Source Information -->
            <section class="source-section">
                <div class="card">
                    <p class="source-text">
                        <strong>Source:</strong> Department of Consumer Affairs, Ministry of Consumer Affairs, Food and Public Distribution, Government of India.
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Loading data...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script>
        // Check if D3 loaded properly and add fallback
        if (typeof d3 === 'undefined') {
            console.error('D3.js failed to load from CDN');
            window.d3Loaded = false;
        } else {
            console.log('D3.js loaded successfully');
            window.d3Loaded = true;
        }
    </script>
    <script src="./script.js"></script>
</body>
</html>
